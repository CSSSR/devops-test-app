# Release Notes

## Feature: FEAT-1

### Zero-Downtime Deployment
**Application Changes:**
- Основной файл `main.go` добавлен функционал работы с кешем Redis.
- Добавлен **мьютекс** для управления загрузкой изображения:
  - При загрузке:
    - Приложение проверяет состояние мьютекса и ждет его освобождения в течение `MUTEX-WAITING-PERIOD`.
    - Если мьютекс свободен:
      - Захватывает мьютекс с TTL (`MUTEX-TTL`).
      - Запускает параллельный процесс обновления мьютекса.
      - Загружает новое изображение.
      - Обновляет ссылку на новое изображение.
      - Удаляет ключ старого изображения.
      - Снимает мьютекс.

**Helm Changes:**
- Добавлена зависимость от **Redis**.
- В **Deployment** добавлены переменные окружения:
  - `MUTEX-TTL`
  - `MUTEX-WAITING-PERIOD`
  - `REDIS_HOST`
  - `REDIS_PORT`
  - `REDIS_DB`
- PVC создается только для **StatefulSet Redis**.
- В **Deployment** задан параметр `StrategyType: RollingUpdate`.
- Количество реплик в Deployment для **мастера** установлено `replicas > 1`.

---

### 100% Uptime
**Helm Changes:**
- В **Deployment** добавлены пробы:
  - `LivenessProbe` для проверки жизнеспособности подов.
  - `ReadinessProbe` для проверки готовности подов.
- Добавлены **Affinity**-правила, чтобы scheduler размещал поды на разных нодах (повышение отказоустойчивости).

---

### Другие улучшения сборки и деплоя
- **Dockerfile** оптимизирован и теперь состоит из двух этапов:
  1. **Сборка** (build).
  2. **Запуск** (run).
- Это позволило уменьшить размер конечного образа.

---

### To Do
**Необходимо реализовать:**
1. Добавить библиотеку для разделения логирования на уровни (info, debug, error).
2. Добавить полноценную обработку ошибок в сервисе.
3. Реализовать маршруты для получения метрик сервиса.
4. Подключить, например, prometheus-operator и добавить аннотации к подам чтобы он начал собирать с них метрики 